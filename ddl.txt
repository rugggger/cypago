CREATE TYPE resource_type AS ENUM ('user', 'group', 'repository', 'branch');

CREATE TABLE resources (
    um SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    type resource_type NOT NULL,
    data JSONB,
    date TIMESTAMP DEFAULT NOW(),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE scans (
    id SERIAL PRIMARY KEY,
    resource_id INT REFERENCES resources(um) ON DELETE CASCADE,
    start TIMESTAMP DEFAULT NOW(),
    finish TIMESTAMP,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    UNIQUE (resource_id)
);


INSERT INTO resources (name, type)
VALUES ('Sample Image', 'user')
RETURNING um;

INSERT INTO scans (resource_id)
VALUES (1)
RETURNING id;

DELETE FROM resources WHERE um = 1;

DROP TABLE IF EXISTS scans;
DROP TABLE IF EXISTS resources;



